# EligibleHound PowerShell Script

## üìù Description

This PowerShell script processes a combination of a CSV file containing role assignments from Azure Portal and a JSON file in AzureHound format.  
It identifies **"Eligible"** role assignments from the CSV and creates a new JSON file for these assignments.  
The result is saved to a new JSON file and can be uploaded to BloodHound.

## üìÇ Input Files

- **CSV File (`export_example.csv`)**  
  A CSV export from Azure Portal. Contains role assignments with the following relevant columns:
  - `Role Name`
  - `PrincipalName`
  - `Assignment State` (only entries with the value `Eligible` are processed)

- **JSON File (`azurehound_example.json`)**  
  A BloodHound-compatible JSON file, for example coming from AzureHound, containing objects of types:
  - `AZRole`
  - `AZUser`
  - `AZRoleAssignment`

## üì§ Output File

- **`eligiblehound.json`**  
  A JSON file containing the eligible role assignments, that can be uploaded to BloodHound.

## ‚öôÔ∏è How It Works

1. **Read the JSON file**  
   Parses the file and extracts role and user information.

2. **Read and filter the CSV file**  
   Only entries marked as `Eligible` are considered.

3. **Resolve role and user IDs**  
   Matches names from the CSV to IDs from the JSON.

4. **Create new role assignments**  
   For each valid match, a new JSON entry is generated and appended.

5. **Save the JSON file contain the eligible role assignments**

## ‚ñ∂Ô∏è Usage
```powershell
# Set the correct paths for the input and output files in the script
$csvPath = "export_example.csv"
$jsonPath = "azurehound_example.json"
$outputPath = "eligiblehound.json"
```

```powershell
# Ensure the input files are in the same directory or adjust the paths accordingly
.\EligibleHound.ps1
```

In BloodHound, first upload the full JSON file from AzureHound, then upload the JSON file generated by this script to update the database with the eligible role assignments.

## ‚ö†Ô∏è Notes

- The script expects the CSV file to use a semicolon (`;`) as the delimiter.
- It‚Äôs recommended to back up the original files before running the script.
- When processing large JSON files, the system memory might get exhausted, causing the script to crash.
- Some fields in the generated role assignments (e.g., `roleDefinition`, `appScope`) contain placeholder values, as they cannot be derived from the CSV.

## üìå Example Output

```
Starting to read JSON azurehound_example.json
Reading JSON completed
Starting to read CSV export_example.csv
Reading CSV completed
Assignment added by EligibleHound: Contributor : user@example.com
Writing JSON completed
```
